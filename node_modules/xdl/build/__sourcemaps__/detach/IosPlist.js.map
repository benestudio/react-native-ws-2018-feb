{"version":3,"sources":["detach/IosPlist.js"],"names":["async","plistPath","plistName","transform","let","plistFilename","_getNormalizedPlistFilename","configPlistName","path","join","configFilename","config","process","platform","await","spawnAsyncThrowError","configContents","fs","readFile","JSON","parse","e","console","log","plist","readFileSync","writeFile","stringify","build","modifyAsync","emptyConfig","tmpConfigFile","createBlankAsync","restoreOriginal","cleanBackupAsync","indexOf"],"mappings":"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","file":"../../detach/IosPlist.js","sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport plist from 'plist';\n\nimport { spawnAsyncThrowError } from './ExponentTools';\n\nfunction _getNormalizedPlistFilename(plistName) {\n  let plistFilename;\n  if (plistName.indexOf('.') !== -1) {\n    plistFilename = plistName;\n  } else {\n    plistFilename = `${plistName}.plist`;\n  }\n  return plistFilename;\n}\n\n/**\n *  @param plistName base filename of property list. if no extension, assumes .plist\n */\nasync function modifyAsync(plistPath, plistName, transform) {\n  let plistFilename = _getNormalizedPlistFilename(plistName);\n  let configPlistName = path.join(plistPath, plistFilename);\n  let configFilename = path.join(plistPath, `${plistName}.json`);\n\n  // grab original plist as json object\n  let config;\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'json',\n      configPlistName,\n      '-o',\n      configFilename,\n    ]);\n    let configContents = await fs.readFile(configFilename, 'utf8');\n\n    try {\n      config = JSON.parse(configContents);\n    } catch (e) {\n      console.log(`Error parsing ${configFilename}`, e);\n      console.log('The erroneous file contents was:', configContents);\n      config = {};\n    }\n  } else {\n    config = plist.parse(fs.readFileSync(configPlistName, 'utf8'));\n  }\n\n  // apply transformation\n  config = transform(config);\n\n  // back up old plist and swap in modified one\n  await spawnAsyncThrowError('/bin/cp', [configPlistName, `${configPlistName}.bak`]);\n  await fs.writeFile(configFilename, JSON.stringify(config));\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'xml1',\n      configFilename,\n      '-o',\n      configPlistName,\n    ]);\n  } else {\n    await fs.writeFile(configPlistName, plist.build(config));\n  }\n\n  return config;\n}\n\nasync function createBlankAsync(plistPath, plistName) {\n  // write empty json file\n  const emptyConfig = {};\n  const tmpConfigFile = path.join(plistPath, `${plistName}.json`);\n  await fs.writeFile(tmpConfigFile, JSON.stringify(emptyConfig));\n\n  // convert to plist\n  let plistFilename = _getNormalizedPlistFilename(plistName);\n  let configPlistName = path.join(plistPath, plistFilename);\n  if (process.platform === 'darwin') {\n    await spawnAsyncThrowError('plutil', [\n      '-convert',\n      'xml1',\n      tmpConfigFile,\n      '-o',\n      configPlistName,\n    ]);\n  } else {\n    await fs.writeFile(configPlistName, JSON.stringify(plist.build(emptyConfig)));\n  }\n\n  // remove tmp json file\n  await spawnAsyncThrowError('/bin/rm', [tmpConfigFile]);\n}\n\nasync function cleanBackupAsync(plistPath, plistName, restoreOriginal = true) {\n  let plistFilename = _getNormalizedPlistFilename(plistName);\n  let configPlistName = path.join(plistPath, plistFilename);\n  let configFilename = path.join(plistPath, `${plistName}.json`);\n\n  if (restoreOriginal) {\n    await spawnAsyncThrowError('/bin/cp', [`${configPlistName}.bak`, configPlistName]);\n  }\n\n  await spawnAsyncThrowError('/bin/rm', [`${configPlistName}.bak`]);\n  await spawnAsyncThrowError('/bin/rm', [configFilename]);\n}\n\nexport { modifyAsync, cleanBackupAsync, createBlankAsync };\n"],"sourceRoot":"/xdl/src"}