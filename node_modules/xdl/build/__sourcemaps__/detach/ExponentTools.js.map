{"version":3,"sources":["detach/ExponentTools.js"],"names":["async","url","headers","let","requestOptions","replace","response","await","request","responseBody","body","console","log","manifest","JSON","parse","e","Error","getManifestAsync","args","length","spawnAsyncQuiet","stdio","cwd","process","spawnAsyncThrowError","error","message","spawnAsync","filename","transform","fileString","fs","readFile","newFileString","writeFile","transformFileContentsAsync","Request","defaults","resolveWithFullResponse","_getFilesizeInBytes","path","stats","statSync","fileSizeInBytes","parseSdkMajorVersion","expSdkVersion","sdkMajorVersion","versionComponents","split","map","number","parseInt","_","saveUrlToPathAsync","Promise","resolve","reject","stream","createWriteStream","on","pipe","saveImageToPathAsync","projectRoot","pathOrURL","outPath","localPath","existsSync","createReadStream","manifestUsesSplashApi","platform","splash","ios","android","rimrafDontThrow","directory","rimraf","sync","warn","isDirectory","dir"],"mappings":"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","file":"../../detach/ExponentTools.js","sourcesContent":["// Copyright 2015-present 650 Industries. All rights reserved.\n\n'use strict';\n\nimport fs from 'fs-extra';\nimport path from 'path';\nimport Request from 'request-promise-native';\nimport rimraf from 'rimraf';\nimport spawnAsyncQuiet from '@expo/spawn-async';\n\nconst request = Request.defaults({\n  resolveWithFullResponse: true,\n});\n\nfunction _getFilesizeInBytes(path) {\n  let stats = fs.statSync(path);\n  let fileSizeInBytes = stats['size'];\n  return fileSizeInBytes;\n}\n\nfunction parseSdkMajorVersion(expSdkVersion) {\n  let sdkMajorVersion = 0;\n  try {\n    let versionComponents = expSdkVersion.split('.').map(number => parseInt(number, 10));\n    sdkMajorVersion = versionComponents[0];\n  } catch (_) {}\n  return sdkMajorVersion;\n}\n\nfunction saveUrlToPathAsync(url, path) {\n  return new Promise(function(resolve, reject) {\n    let stream = fs.createWriteStream(path);\n    stream.on('close', () => {\n      if (_getFilesizeInBytes(path) < 10) {\n        throw new Error(`{filename} is too small`);\n      }\n      resolve();\n    });\n    stream.on('error', reject);\n    request(url).pipe(stream);\n  });\n}\n\nfunction saveImageToPathAsync(projectRoot, pathOrURL, outPath) {\n  const localPath = path.resolve(projectRoot, pathOrURL);\n  return new Promise(function(resolve, reject) {\n    let stream = fs.createWriteStream(outPath);\n    stream.on('close', () => {\n      if (_getFilesizeInBytes(outPath) < 10) {\n        throw new Error(`{filename} is too small`);\n      }\n      resolve();\n    });\n    stream.on('error', reject);\n    if (fs.existsSync(localPath)) {\n      fs.createReadStream(localPath).pipe(stream);\n    } else {\n      request(pathOrURL).pipe(stream);\n    }\n  });\n}\n\nasync function getManifestAsync(url, headers) {\n  let requestOptions = {\n    url: url.replace('exp://', 'http://') + '/index.exp',\n    headers,\n  };\n\n  let response = await request(requestOptions);\n  let responseBody = response.body;\n  console.log('Using manifest:', responseBody);\n  let manifest;\n  try {\n    manifest = JSON.parse(responseBody);\n  } catch (e) {\n    throw new Error(`Unable to parse manifest: ${e}`);\n  }\n\n  return manifest;\n}\n\nasync function spawnAsyncThrowError(...args) {\n  if (args.length === 2) {\n    return spawnAsyncQuiet(args[0], args[1], {\n      stdio: 'inherit',\n      cwd: process.cwd(),\n    });\n  } else {\n    return spawnAsyncQuiet(...args);\n  }\n}\n\nasync function spawnAsync(...args) {\n  try {\n    return await spawnAsyncThrowError(...args);\n  } catch (e) {\n    console.error(e.message);\n  }\n}\n\nasync function transformFileContentsAsync(filename, transform) {\n  let fileString = await fs.readFile(filename, 'utf8');\n  let newFileString = transform(fileString);\n  if (newFileString !== null) {\n    await fs.writeFile(filename, newFileString);\n  }\n}\n\nfunction manifestUsesSplashApi(manifest, platform) {\n  if (platform === 'ios') {\n    return manifest.splash || (manifest.ios && manifest.ios.splash);\n  }\n  if (platform === 'android') {\n    return manifest.splash || (manifest.android && manifest.android.splash);\n  }\n  return false;\n}\n\nfunction rimrafDontThrow(directory) {\n  try {\n    rimraf.sync(directory);\n  } catch (e) {\n    console.warn(\n      `There was an issue cleaning up, but your project should still work. You may need to manually remove ${directory}. (${e})`\n    );\n  }\n}\n\nfunction isDirectory(dir) {\n  try {\n    if (fs.statSync(dir).isDirectory()) {\n      return true;\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport {\n  isDirectory,\n  parseSdkMajorVersion,\n  saveUrlToPathAsync,\n  saveImageToPathAsync,\n  getManifestAsync,\n  rimrafDontThrow,\n  spawnAsyncThrowError,\n  spawnAsync,\n  transformFileContentsAsync,\n  manifestUsesSplashApi,\n};\n"],"sourceRoot":"/xdl/src"}