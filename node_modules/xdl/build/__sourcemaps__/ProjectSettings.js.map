{"version":3,"sources":["ProjectSettings.js"],"names":["async","projectRoot","let","projectSettings","await","projectSettingsJsonFile","projectSettingsFile","readAsync","e","writeAsync","projectSettingsDefaults","hostType","urlType","strict","_","defaults","json","mergeAsync","cantReadFileDefault","setAsync","packagerInfoFile","readPackagerInfoAsync","setPackagerInfoAsync","getPackagerOptsAsync","dotExpoProjectDirectory","dotExpoProjectDirectoryExists","lanType","dev","minify","urlRandomness","filename","path","join","dirPath","oldDirPath","fs","statSync","isDirectory","renameSync","mkdirp","sync"],"mappings":"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","file":"../ProjectSettings.js","sourcesContent":["/**\n * @flow\n */\n\nimport _ from 'lodash';\nimport JsonFile from '@expo/json-file';\nimport fs from 'fs';\nimport mkdirp from 'mkdirp';\nimport path from 'path';\n\nlet projectSettingsFile = 'settings.json';\nlet projectSettingsDefaults = {\n  hostType: 'tunnel',\n  lanType: 'ip',\n  dev: true,\n  minify: false,\n  urlRandomness: null,\n};\nlet packagerInfoFile = 'packager-info.json';\n\nfunction projectSettingsJsonFile(projectRoot: string, filename: string) {\n  return new JsonFile(path.join(dotExpoProjectDirectory(projectRoot), filename));\n}\n\nexport async function readAsync(projectRoot: string) {\n  let projectSettings;\n  try {\n    projectSettings = await projectSettingsJsonFile(projectRoot, projectSettingsFile).readAsync();\n  } catch (e) {\n    projectSettings = await projectSettingsJsonFile(projectRoot, projectSettingsFile).writeAsync(\n      projectSettingsDefaults\n    );\n  }\n\n  if (projectSettings.hostType === 'ngrok') {\n    // 'ngrok' is deprecated\n    projectSettings.hostType = 'tunnel';\n  }\n\n  if (projectSettings.urlType) {\n    // urlType is deprecated as a project setting\n    delete projectSettings.urlType;\n  }\n\n  if ('strict' in projectSettings) {\n    // strict mode is not supported at the moment\n    delete projectSettings.strict;\n  }\n\n  // Set defaults for any missing fields\n  _.defaults(projectSettings, projectSettingsDefaults);\n  return projectSettings;\n}\n\nexport async function setAsync(projectRoot: string, json: any) {\n  try {\n    return await projectSettingsJsonFile(projectRoot, projectSettingsFile).mergeAsync(json, {\n      cantReadFileDefault: projectSettingsDefaults,\n    });\n  } catch (e) {\n    return await projectSettingsJsonFile(projectRoot, projectSettingsFile).writeAsync(\n      _.defaults(json, projectSettingsDefaults)\n    );\n  }\n}\n\nexport async function readPackagerInfoAsync(projectRoot: string) {\n  try {\n    return await projectSettingsJsonFile(projectRoot, packagerInfoFile).readAsync({\n      cantReadFileDefault: {},\n    });\n  } catch (e) {\n    return await projectSettingsJsonFile(projectRoot, packagerInfoFile).writeAsync({});\n  }\n}\n\nexport async function setPackagerInfoAsync(projectRoot: string, json: any) {\n  try {\n    return await projectSettingsJsonFile(projectRoot, packagerInfoFile).mergeAsync(json, {\n      cantReadFileDefault: {},\n    });\n  } catch (e) {\n    return await projectSettingsJsonFile(projectRoot, packagerInfoFile).writeAsync(json);\n  }\n}\n\nexport function dotExpoProjectDirectory(projectRoot: string) {\n  let dirPath = path.join(projectRoot, '.expo');\n  try {\n    // move .exponent to .expo\n    let oldDirPath = path.join(projectRoot, '.exponent');\n    if (fs.statSync(oldDirPath).isDirectory()) {\n      fs.renameSync(oldDirPath, dirPath);\n    }\n  } catch (e) {\n    // no old directory, continue\n  }\n\n  mkdirp.sync(dirPath);\n  return dirPath;\n}\n\nexport function dotExpoProjectDirectoryExists(projectRoot: string) {\n  let dirPath = path.join(projectRoot, '.expo');\n  try {\n    if (fs.statSync(dirPath).isDirectory()) {\n      return true;\n    }\n  } catch (e) {\n    // file doesn't exist\n  }\n\n  return false;\n}\n\nexport async function getPackagerOptsAsync(projectRoot: string) {\n  let projectSettings = await readAsync(projectRoot);\n  return projectSettings;\n}\n"],"sourceRoot":"/xdl/src"}